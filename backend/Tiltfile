# Backend-specific Tiltfile for agent-communications-dashboard
# Can be run standalone from the backend/ directory

# Apply Kubernetes manifests for backend only
k8s_yaml(kustomize('../deploy/local'))

# Build and deploy the agent communications dashboard backend
dashboard_backend_name = 'agent-communications-dashboard-backend'

docker_build(
    dashboard_backend_name,
    context='.',
    ignore=['.import_linter_cache', '.mypy_cache', '.pytest_cache', '.ruff_cache', '__pycache__'],
    live_update=[
        # Sync source code changes into the container
        sync('src', '/app/src'),
        sync('tests', '/app/tests'),

        # Re-install dependencies if the project files change
        run(
            'uv sync --frozen',
            trigger=['pyproject.toml', 'uv.lock']
        )
    ]
)

k8s_resource(
    dashboard_backend_name,
    port_forwards='10005:8000',
    labels=['agent-communications-dashboard']
)